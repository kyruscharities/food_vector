-#- content_for :head do
= javascript_tag do
  var center_point = #{raw resource.geo_region.center_point.to_json}
  var region_data = #{raw resource.analysis_geo_region_scores.to_json}
  var food_data = #{raw resource.located_food_sources.to_json}
  var bounds = #{raw resource.geo_region.to_json}

%section
  .col-xs-10
    %h2.page-header
      = resource.name
      %span.pull-right

    %p.lead= resource.description

    %p
      %b Region of interest:
      = geo_region_coords resource

    - if resource.analysis_complete?

      %div{style: 'width: 100%;'}
        #map{style: 'width: 100%; height: 400px;'}

      %h3.page-header Located Food Sources
      %p
        %b Number of located food sources:
        - if resource.located_food_sources.empty?
          There are no food sources in this geo region!
        - else
          = resource.located_food_sources.count

      -#%p
      -#  %b Number of located unhealthy food sources:
      -#  - if resource.located_unhealthy_food_sources.empty?
      -#    There are no unhealthy food sources in this geo region.
      -#  - else
      -#    = resource.located_unhealthy_food_sources.count

      %h3.page-header Analysis Details
      %ul
        - resource.analysis_geo_region_scores.each do |region|
          %li
            %p
              %span{style: 'display: inline-block;min-width: 100px'}
                RISK
                %code= region.risk_score
              = geo_region_coords region.geo_region

  .col-xs-2
    .alert.alert-info.text-center{style: 'margin-top: 45px;'}
      - if resource.analysis_complete?
        %i.fa.fa-4x.fa-check
        %p
          = resource.analysis_progress
          regions analyzed

      - else
        %i.fa.fa-4x.fa-spinner.fa-spin
        %p
          Analyzing
          %br
          = resource.analysis_progress
          regions

      %p
        = link_to 'Re-analyze', analyze_analysis_path(resource), method: :post, class: 'btn btn-primary' #if resource.analysis_complete?
